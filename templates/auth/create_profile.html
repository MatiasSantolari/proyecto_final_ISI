{% include 'auth/partials/base_head2.html' %}
{% load widget_tweaks %}
{% load static %}

<link rel="stylesheet" href="{% static 'css/navbar.css' %}">

<style>
  body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: url('{% static "img/fondo_login.png" %}') no-repeat center center;
      background-size: cover;
    }

    .card-header-styled {
      padding: 1rem 1rem; 
    }

    #theme-toggle {
        background: rgba(255, 255, 255, 0.1); /* Fondo sutil */
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
    }

    #theme-toggle:hover {
        background: rgba(255, 255, 255, 0.2);
    }
</style>

<body class="bg-info-subtle text-dark"> 
  <div class="container d-flex justify-content-center align-items-center" style="min-height: 100vh;">
    <div class="card shadow p-4 w-100" style="max-width: 800px;">
      
      <div class="card-header-styled text-center position-relative">
        <h2 class="mt-0 text-white">Crear Perfil</h2>
        <p class="text-white-50 mb-0">Complet√° tus datos personales para continuar.</p>
        <button id="theme-toggle" class="btn nav-item position-absolute top-0 end-0 m-3">
          <span id="theme-icon">üåô</span> 
        </button>
      </div>
      
      <form method="POST" enctype="multipart/form-data" class="text-start">
        {% csrf_token %}
        {% if form.non_field_errors %}
            <div class="alert alert-danger">{{ form.non_field_errors }}</div>
        {% endif %}
        
        <div class="text-center mb-4">
          <div id="avatarContainer" class="position-relative d-inline-block" style="cursor: pointer; width: 100px; height: 100px;">
            <div class="position-relative" style="width: 100px; height: 100px;">
              
              <img id="previewAvatar"
                  src="{{ avatar_url|default:'' }}"
                  class="rounded-circle border shadow position-absolute top-0 start-0"
                  style="width: 100%; height: 100%; object-fit: cover; {% if not avatar_url %}display:none;{% endif %} z-index: 2;"
                  alt="Avatar">

                <div id="defaultAvatarIcon"
                  class="rounded-circle border shadow d-flex justify-content-center align-items-center bg-secondary text-white position-absolute top-0 start-0"
                  style="width: 100%; height: 100%; font-size: 5rem; {% if avatar_url %}display:none;{% endif %} z-index: 1;">
                <svg xmlns="www.w3.org" width="64" height="64" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                  <path d="M13.468 12.37C12.758 11.226 11.48 10.5 10 10.5c-1.48 0-2.758.726-3.468 1.87A6.987 6.987 0 0 1 8 15a6.987 6.987 0 0 1 5.468-2.63z"/>
                  <path fill-rule="evenodd" d="M8 9a3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                  <path fill-rule="evenodd" d="M8 1a7 7 0 1 1 0 14A7 7 0 0 1 8 1z"/>
                </svg>
              </div>
            </div>

            <div class="position-absolute bg-primary rounded-circle d-flex justify-content-center align-items-center"
                id="avatarPlus"
                style="width: 24px; height: 24px; bottom: 5px; right: 5px; cursor: pointer; font-size: 1rem; z-index: 3;">
              <i class="bi bi-plus text-white"></i>
            </div>

            <input type="file" name="avatar" id="id_avatar" accept="image/*" class="d-none">
          </div>
        </div>
      

        <div class="row g-3">
          <div class="col-md-6">
            <label for="{{ form.nombre.id_for_label }}" class="form-label">Nombre</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                {% render_field form.nombre class="form-control" placeholder="Ingres√° tu nombre" %}
            </div>
            {{ form.nombre.errors }}
          </div>

          <div class="col-md-6">
            <label for="{{ form.apellido.id_for_label }}" class="form-label">Apellido</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                {% render_field form.apellido class="form-control" placeholder="Ingres√° tu apellido" %}
            </div>
            {{ form.apellido.errors }}
          </div>

          <div class="col-md-6">
            <label for="{{ form.dni.id_for_label }}" class="form-label">DNI</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-credit-card-2-front-fill"></i></span>
                {% render_field form.dni class="form-control" placeholder="DNI" %}
            </div>
            {{ form.dni.errors }}
          </div>

          <div class="col-md-6">
            <label for="{{ form.email.id_for_label }}" class="form-label">Email</label>
             <div class="input-group">
                <span class="input-group-text"><i class="bi bi-envelope-fill"></i></span>
                {% render_field form.email class="form-control" placeholder="Correo electr√≥nico" %}
            </div>
            {{ form.email.errors }}
          </div>

          <div class="col-md-6">
            <label for="{{ form.fecha_nacimiento.id_for_label }}" class="form-label">Fecha de Nacimiento</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-calendar-fill"></i></span>
                {% render_field form.fecha_nacimiento class="form-control" %}
            </div>
            {{ form.fecha_nacimiento.errors }}
          </div>

          <div class="col-md-6">
            <label for="{{ form.genero.id_for_label }}" class="form-label">G√©nero</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-gender-ambiguous"></i></span>
                {% render_field form.genero class="form-select" %}
            </div>
            {{ form.genero.errors }}
          </div>

          
          <div class="col-12 mt-3">
            <label class="form-label fw-semibold">Tel√©fono</label>
            <div class="row g-3">
              <div class="col-md-3">
                 <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-globe"></i></span>
                    {% render_field form.prefijo_pais class="form-control" placeholder="Cod. Pa√≠s" %}
                 </div>
                 {{ form.prefijo_pais.errors }}
              </div>
              <div class="col-md-9">
                 <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-telephone-fill"></i></span>
                    {% render_field form.telefono class="form-control" placeholder="N√∫mero de tel√©fono" %}
                 </div>
                 {{ form.telefono.errors }}
              </div>
            </div>
          </div>

          
          <div class="col-12 mt-3">
            <label class="form-label fw-semibold">Direcci√≥n</label>
            <div class="row g-3">
              <div class="col-md-5">
                 <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-flag"></i></span>
                    {% render_field form.pais class="form-control" placeholder="Pa√≠s" %}
                 </div>
                {{ form.pais.errors }}
              </div>
              <div class="col-md-7">
                 <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-map-fill"></i></span>
                    {% render_field form.provincia class="form-control" placeholder="Provincia" %}
                 </div>
                {{ form.provincia.errors }}
              </div>
              <div class="col-md-5">
                 <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-geo-alt-fill"></i></span>
                    {% render_field form.ciudad class="form-control" placeholder="Ciudad" %}
                 </div>
                {{ form.ciudad.errors }}
              </div>
              <div class="col-md-4">
                 <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-signpost-2-fill"></i></span>
                    {% render_field form.calle class="form-control" placeholder="Calle" %}
                 </div>
                {{ form.calle.errors }}
              </div>
              <div class="col-md-3">
                 <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-hash"></i></span>
                    {% render_field form.numero class="form-control" placeholder="N√∫mero" %}
                 </div>
                {{ form.numero.errors }}
              </div>
            </div>
          </div>

        </div>

        <button type="submit" class="btn btn-primary w-100 fw-bold shadow mt-4">
          <i class="bi bi-person-check-fill me-2"></i> Guardar perfil
        </button>
      </form>
    </div>
  </div>

  {% include 'auth/partials/base_scripts.html' %}

  <script>
    document.addEventListener("DOMContentLoaded", function () {
        const toggleBtn = document.getElementById("theme-toggle");
        const themeIcon = document.getElementById("theme-icon");
        const savedTheme = localStorage.getItem("theme");

        function applyTheme(theme) {
            if (theme === "dark") {
                document.body.classList.add("dark-mode");
                themeIcon.textContent = "‚òÄÔ∏è"; 
            } else {
                document.body.classList.remove("dark-mode");
                themeIcon.textContent = "üåô"; 
            }
        }
        
        if (savedTheme) {
        applyTheme(savedTheme);
        } else {
            applyTheme("light"); 
        }

        toggleBtn.addEventListener("click", function () {
            const isDarkMode = document.body.classList.contains("dark-mode");
            
            const newTheme = isDarkMode ? "light" : "dark";

            applyTheme(newTheme);
            localStorage.setItem("theme", newTheme);
        });
    });

    const avatarContainer = document.getElementById('avatarContainer');
    const avatarInput = document.getElementById('id_avatar');
    const previewAvatar = document.getElementById('previewAvatar');
    const defaultAvatarIcon = document.getElementById('defaultAvatarIcon');

    avatarContainer.addEventListener('click', () => {
      avatarInput.click();
    });

    avatarInput.addEventListener('change', () => {
      const file = avatarInput.files;
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          previewAvatar.src = e.target.result;
          previewAvatar.style.display = 'block';
          defaultAvatarIcon.style.display = 'none';
        };
        reader.readAsDataURL(file);
      } else {
        previewAvatar.src = '';
        previewAvatar.style.display = 'none';
        defaultAvatarIcon.style.display = 'flex';
      }
    });
  </script>


{% if avatar_url %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const preview = document.getElementById('previewAvatar');
  const icon = document.getElementById('defaultAvatarIcon');
  if ("{{ avatar_url|default:'' }}".length > 0) {
      preview.src = "{{ avatar_url }}";
      preview.style.display = 'block';
      icon.style.display = 'none';
  }
});
</script>
{% endif %}


</body>
</html>
