{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}Gestionar Solicitudes de Vacaciones{% endblock %}

{% block content %}
<div class="container my-5">
  <h2>Solicitudes de Vacaciones</h2>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Empleado</th>
        <th>Departamento</th>
        <th>Inicio</th>
        <th>Fin</th>
        <th>Días Solicitados</th>
        <th>Días Disponibles</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for s in solicitudes %}
      <tr>
        <td>{{ s.empleado }}</td>
        <td>{{ s.empleado.departamento_actual_nombre }}</td>
        <td>{{ s.fecha_inicio|date:"d/m/Y" }}</td>
        <td>{{ s.fecha_fin|date:"d/m/Y" }}</td>
        <td>{{ s.cant_dias_solicitados }}</td>
        <td>{{ s.empleado.cantidad_dias_disponibles }}</td>
        <td>
        {% if s.estado == "rechazado"%}
                <span class="badge bg-danger">{{ s.estado }}</span>
          {% elif s.estado == "pendiente" %}
                <span class="badge bg-warning">{{ s.estado }}</span>
          {% elif s.estado == "aprobado" %}
                <span class="badge bg-success">{{ s.estado }}</span>
          {% endif %}
        </td>
        <td>
          {% if s.estado == "pendiente" %}
          <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalAprobar{{ s.id }}">
            Aprobar
          </button>
          <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalRechazar{{ s.id }}">
            Rechazar
          </button>
          {% else %}
            -
          {% endif %}
        </td>
      </tr>

      <!-- Modal Aprobar -->
      <div class="modal fade" id="modalAprobar{{ s.id }}" tabindex="-1" aria-labelledby="modalAprobarLabel{{ s.id }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content text-center">
            <div class="modal-header bg-success text-white">
              <h5 class="modal-title" id="modalAprobarLabel{{ s.id }}">Confirmar Aprobación</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              ¿Estás seguro de aprobar las vacaciones de <strong>{{ s.empleado }}</strong> del 
              <strong>{{ s.fecha_inicio|date:"d/m/Y" }}</strong> al <strong>{{ s.fecha_fin|date:"d/m/Y" }}</strong>?
            </div>
            <div class="modal-footer justify-content-center">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <a href="{% url 'cambiar_estado_vacacion' s.id 'aprobar' %}" class="btn btn-success">Confirmar</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal Rechazar -->
      <div class="modal fade" id="modalRechazar{{ s.id }}" tabindex="-1" aria-labelledby="modalRechazarLabel{{ s.id }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content text-center">
            <div class="modal-header bg-danger text-white">
              <h5 class="modal-title" id="modalRechazarLabel{{ s.id }}">Confirmar Rechazo</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              ¿Estás seguro de rechazar la solicitud de vacaciones de <strong>{{ s.empleado }}</strong> del 
              <strong>{{ s.fecha_inicio|date:"d/m/Y" }}</strong> al <strong>{{ s.fecha_fin|date:"d/m/Y" }}</strong>?
            </div>
            <div class="modal-footer justify-content-center">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <a href="{% url 'cambiar_estado_vacacion' s.id 'rechazar' %}" class="btn btn-danger">Confirmar</a>
            </div>
          </div>
        </div>
      </div>

      {% empty %}
      <tr><td colspan="8" class="text-center text-muted">No hay solicitudes.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}