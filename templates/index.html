{% extends "base.html"%}

{% block title %}P√°gina Principal{% endblock %}

{% block content %}
<div class="content">
    <div class="container-fluid ml-0 mt-3"><hr>

        {% if request.session.rol_actual == 'admin'%}
            <div class="d-flex gap-1 flex-wrap">    
                {% include "dashboard/dashboard.html" %}                
            </div>
        {% else %}
            <div class="d-flex gap-1 flex-wrap">    
                {% include "dashboard/dashboard_empleado.html" %}                
            </div>
        
        <!--    
            <h4 class="mb-5 mt-4">Bienvenido al Sistema</h4>
            <div class="row" id="user-content">
                <div class="col-md-4 mb-4">
                    <div class="card bg-soft-success bg-light text-dark border-start border-4 border-success shadow-sm h-100 rounded-4">
                        <div class="card-body">
                            <h5 class="card-title">üéØ Objetivos/Tareas</h5>
                            <hr>
                            {% if objetivos_con_estado %}
                                {% for item in objetivos_con_estado %}
                                    <div class="form-check mb-2">
                                        <input class="form-check-input objetivo-check" type="checkbox"
                                            data-id="{{ item.objetivo.id }}"
                                            {% if item.completado %}checked{% endif %}>
                                        <label class="form-check-label {% if item.completado %}objetivo-completado{% endif %}">
                                            {{ item.objetivo.titulo }}
                                        </label>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <p>No tienes objetivos asignados.</p>
                            {% endif %}
                            <div class="progress mt-4">
                                <div id="barra-progreso" class="progress-bar bg-success" role="progressbar"
                                    style="min-width: 30px; width: {{ progreso }}%;">
                                    {{ progreso }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-4">
                    <div class="card bg-soft-warning bg-light text-dark border-start border-4 border-warning shadow-sm h-100 rounded-4">
                        <div class="card-body">
                            <h5 class="card-title">üèÜ Logros y Reconocimientos</h5><hr><hr>
                            <p>√öltimo logro: <strong>Empleado del mes</strong></p>
                            <p>¬°Sigue as√≠! Pr√≥ximo logro en 2 tareas.</p>
                        </div>    
                    </div>
                </div>

                <div class="col-md-4 mb-4">
                    <div class="card bg-soft-info bg-light text-dark border-start border-4 border-info shadow-sm h-100 rounded-4">
                        <div class="card-body">
                            <h5 class="card-title">üìÖ Tareas Pendientes</h5><hr><hr>
                            <p>üü¢ Evaluar desempe√±o de tu equipo</p>
                            <p>üî¥ Completar autoevaluaci√≥n</p>
                            <p>üü° Asistir a la reuni√≥n mensual</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-4">
                    <div class="card bg-soft-mint bg-light text-dark border-start border-4 border-mint shadow-sm h-100 rounded-4">
                        <div class="card-body">
                            <h5 class="card-title">üí∞ Beneficios Disponibles</h5><hr><hr>
                            <p><strong>3 d√≠as</strong> de home office acumulados.</p>
                            <p>Cr√©dito de bienestar: <strong>$500 en cursos</strong></p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-4">
                    <div class="card bg-soft-primary bg-light text-dark border-start border-4 border-primary shadow-sm h-100 rounded-4">
                        <div class="card-body">
                            <h5 class="card-title">üìä Informe Personalizado</h5><hr><hr>
                            <p><strong>Asistencia:</strong> 95% este mes</p>
                            <p><strong>Evaluaci√≥n de desempe√±o:</strong> 4.5/5 ‚≠ê</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-4">
                    <div class="card bg-soft-danger bg-light text-dark border-start border-4 border-danger shadow-sm h-100 rounded-4">
                        <div class="card-body">
                            <h5 class="card-title">üì£ Anuncios Importantes</h5><hr><hr>
                            <p>üì¢ Bono por desempe√±o aprobado üèÖ</p>
                            <p>üìÖ Pr√≥xima capacitaci√≥n: Gesti√≥n de Proyectos - 10 Feb</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-4">
                    <div class="card bg-soft-secondary bg-light text-dark border-start border-4 border-secondary shadow-sm h-100 rounded-4">
                        <div class="card-body">
                            <h5 class="card-title">üìú Accesos R√°pidos</h5><hr><hr>
                            <a href="#" class="d-block mb-2 text-decoration-none text-dark">üìå Solicitar Vacaciones</a>
                            <a href="#" class="d-block mb-2 text-decoration-none text-dark">üìå Registrar Asistencia</a>
                            <a href="#" class="d-block mb-2 text-decoration-none text-dark">üìå Postularse a una Oferta Interna</a>
                        </div>
                    </div>
                </div>
            </div>
        -->
        {% endif %}

    </div>
</div>


{% include "chatbot_modal.html" %}


    

<style>
  .btn-chatbot {
    position: fixed;
    bottom: 40px;
    right: 25px;
    background-color: #0abcdfff;
    color: white;
    border: none;
    border-radius: 50%;
    width: 55px;
    height: 55px;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 1050; 
  }

  .btn-chatbot:hover {
    background-color: #0bb3d9;
    transform: scale(1.1);
  }
</style>

{% endblock %}


<style>
    .objetivo-completado {
        text-decoration: line-through;
        color: gray;
        opacity: 0.6;
        transition: all 0.3s ease;
    }
</style>

{% block extra_js %}
<script>
    function toggleAdminMode() {
        const userContent = document.getElementById('user-content');
        const adminContent = document.getElementById('admin-content');
        userContent.classList.toggle('d-none');
        adminContent.classList.toggle('d-none');
    }


    $(document).on("change", ".objetivo-check", function() {
        let objetivoId = $(this).data("id");
        let completado = $(this).is(":checked");

        let label = $(this).closest(".form-check").find("label");
        if (completado) {
            label.addClass("objetivo-completado");
        } else {
            label.removeClass("objetivo-completado");
        }
        
        $.ajax({
            url: "{% url 'marcar_objetivo' %}",
            type: "POST",
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'objetivo_id': objetivoId,
                'completado': completado
            },
            success: function(response) {
                if (response.success) {
                    $("#barra-progreso")
                        .css("width", response.progreso + "%")
                        .text(response.progreso + "%");
                }
            }
        });
    });

</script>
{% endblock %}
